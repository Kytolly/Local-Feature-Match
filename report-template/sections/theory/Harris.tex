\subsection{Harris角点检测算法}
\subsubsection{概念}
在图像中，角点是指一个局部区域在两个或多个主要方向上都有显著的灰度变化的点。
简单来说，角点可以看作是两条边的交汇处。与平坦区域（在任何方向移动窗口，灰度变化都很小）
和边缘区域（只在一个方向上移动窗口有显著灰度变化）不同，
角点区域在任何方向上移动小窗口都会引起显著的灰度变化。
这使得角点成为图像中重要的、对平移、旋转和光照变化具有一定鲁棒性的特征点。
在本实验中，我们采用Harris角点作为兴趣点，完成对student.py/
\subsubsection{数学原理}
Harris角点检测的核心思想是，在一个像素点周围定义一个小的“窗口”。
然后，计算当这个窗口在水平和垂直方向上分别移动一个小的距离 \((u, v)\) 时，
窗口内的像素灰度值变化的平方和。
灰度变化函数 \(E(u,v)\) 可以表示为：

\[ E(u,v) = \sum_{x,y} w(x,y) [I(x+u, y+v) - I(x,y)]^2 \]
    
其中，\((x,y)\) 是窗口内的像素坐标，\(w(x,y)\) 是一个窗口函数
（可以是常数表示矩形窗口，或者高斯函数表示高斯加权窗口），
\(I(x,y)\) 是像素 \((x,y)\) 的灰度值，\(I(x+u, y+v)\) 是窗口移动后的灰度值。

我们对 \(I(x+u, y+v)\) 进行泰勒展开近似：
    
\[ I(x+u, y+v) \approx I(x,y) + I_x u + I_y v \]
    
其中 \(I_x\) 和 \(I_y\) 分别是图像在 \(x\) 和 \(y\) 方向上的偏导数。

    
\(E(u,v)\) 可以近似表示为矩阵形式：
    
\[ E(u,v) \approx \begin{bmatrix} u & v \end{bmatrix} M \begin{bmatrix} u \\ v \end{bmatrix} \]
    
这里的 \(M\) 是一个 2x2 的结构张量矩阵，定义如下：
    
\[ M = \sum_{x,y} w(x,y) \begin{bmatrix} I_x^2 & I_x I_y \\ I_x I_y & I_y^2 \end{bmatrix} = \begin{bmatrix} \sum I_x^2 & \sum I_x I_y \\ \sum I_x I_y & \sum I_y^2 \end{bmatrix} \]
 
通过对结构张量 \(M\) 进行特征值分解，
可以得到两个特征值 \(\lambda_1\) 和 \(\lambda_2\)。
这两个特征值的大小反映了在特征向量方向上的灰度变化程度。

\begin{enumerate}
    \item 如果 \(\lambda_1\) 和 \(\lambda_2\) 都很小，说明在任何方向上灰度变化都很小，对应的是平坦区域。
    \item 如果一个特征值大，另一个小（例如 \(\lambda_1 \gg \lambda_2\) 或 \(\lambda_2 \gg \lambda_1\)），说明只在一个方向上灰度变化大，对应的是边缘区域。
    \item 如果 \(\lambda_1\) 和 \(\lambda_2\) 都很大且近似相等，说明在各个方向上灰度变化都很大，对应的是角点区域。
\end{enumerate}

\subsubsection{优化}
为了避免直接计算特征值，Harris 提出了一个角点响应函数 \(R\)，通过结构张量 \(M\) 的行列式和迹来计算：
    
\[ R = \det(M) - k (\operatorname{trace}(M))^2 \]

其中，\(\det(M) = \lambda_1 \lambda_2\)，\(\operatorname{trace}(M) = \lambda_1 + \lambda_2\)，\(k\) 是一个经验常数（通常取值在 0.04 到 0.06 之间）。

通过计算每个像素点的 \(R\) 值，我们可以根据 \(R\) 的值来判断该点属于哪种区域：
\begin{enumerate}
    \item 如果 \(|R|\) 很小，该区域是平坦的。
    \item 如果 \(R < 0\)，该区域是边缘。
    \item 如果 \(R\) 很大，该区域是角点。
\end{enumerate}

通常会设置一个阈值，将 \(R\) 值大于该阈值的点标记为候选角点。
由于一个真实的角点可能对应着一片较高的 \(R\) 值区域，
为了获得精确的角点位置，需要进行非极大值抑制。
即在候选角点区域内，只保留局部最大 \(R\) 值对应的像素点作为最终的角点。

\subsubsection{伪代码}
Harris 角点检测算法的步骤大致如下：
\input{sections/theory/harris_algorithm}

\subsubsection{局限性}
Harris角点检测算法在不同尺度下检测到的角点可能会不同。
一个在精细尺度下被检测为角点的特征，在粗糙尺度下可能就不是了。
虽然对于小范围的旋转具有一定的鲁棒性，但对于大角度的旋转，Harris 角点检测的性能会显著下降。
该算法依赖于图像梯度，而梯度计算对图像噪声比较敏感，噪声会影响角点的检测结果。
相比于一些更现代的特征检测算法，Harris 角点检测的计算量相对较大。